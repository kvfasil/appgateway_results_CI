<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebolt Schema Validation Result</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
    .container { max-width: 1100px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #0001; padding: 32px; }
    h1 { text-align: center; }
    .summary { display: flex; justify-content: space-around; margin-bottom: 20px; }
    .summary div { background: #eee; border-radius: 8px; padding: 16px 32px; text-align: center; }
    .summary .passed { color: #2e7d32; font-weight: bold; }
    .summary .failed { color: #c62828; font-weight: bold; }
    .summary .skipped { color: #888; }
    .tabs { display: flex; justify-content: center; flex-wrap: wrap; margin-bottom: 20px; }
    .tab { padding: 12px 32px; cursor: pointer; border-radius: 8px; background: #ddd; margin: 4px; font-weight: bold; }
    .tab.active { background: #1976d2; color: #fff; }
    .test-list { background: #fafafa; border-radius: 0 0 8px 8px; padding: 16px; }
    .test-item { border-bottom: 1px solid #eee; padding: 12px 0; }
    .test-item:last-child { border-bottom: none; }
    .test-name { font-weight: bold; }
    .test-status { margin-left: 12px; font-size: 0.95em; }
    .test-status.passed { color: #2e7d32; }
    .test-status.failed { color: #c62828; }
    .test-status.skipped { color: #888; }
    .test-steps { margin-top: 8px; margin-left: 24px; }
    .step { margin-bottom: 6px; }
    .step .step-desc { font-size: 0.97em; }
    .step .step-status.failed { color: #c62828; }
    .step .step-status.passed { color: #2e7d32; }
    .step .step-status.skipped { color: #888; }
    table { width:100%;border-collapse:collapse;background:#fafafa;border-radius:8px;overflow:hidden;box-shadow:0 1px 4px #0001; margin-bottom: 24px; }
    th, td { padding:8px; text-align:center; }
    thead { background:#1976d2;color:#fff; }
  </style>
</head>
<body>
  <div class="container">
    <h1 id="suiteName">Test Suite To Validate Firebolt Schema Against responses</h1>
    <div style="text-align:center;margin-bottom:8px;">
      <span id="timestamp" style="color:#888;font-size:1em;">Generated On: 20260107_042823</span>
    </div>
    <div class="summary" style="margin-bottom: 20px;">
      <div><span id="totalTests">16</span><br>Total</div>
      <div class="passed"><span id="passedTests">8</span><br>Passed</div>
      <div class="failed"><span id="failedTests">8</span><br>Failed</div>
      <div class="skipped"><span id="skippedTests">0</span><br>Skipped</div>
      <div><span id="duration">1914</span> ms<br>Duration</div>
    </div>
    <div style="margin-bottom: 24px;">
      <table id="categorySummaryTable">
        <thead><tr><th>Category</th><th>Total</th><th>Passed</th><th>Failed</th><th>Skipped</th></tr></thead>
        <tbody id="categorySummaryBody"></tbody>
        <tfoot id="categorySummaryFoot"></tfoot>
      </table>
    </div>
    <div class="tabs" id="categoryTabs" style="margin-bottom: 20px;"></div>
    <div class="tabs" style="margin-bottom: 20px;">
      <div class="tab active" id="tab-all" onclick="showTab('All')">All</div>
      <div class="tab" id="tab-pass" onclick="showTab('Passed')">Pass</div>
      <div class="tab" id="tab-fail" onclick="showTab('Failed')">Fail</div>
    </div>
    <div class="test-list" id="testList"></div>
  </div>
  <script>
    const data = {"suite_name": "Test Suite To Validate Firebolt Schema Against responses", "total_tests": 16, "passed": 8, "failed": 8, "skipped": 0, "duration_ms": 1914, "test_results": [{"test_id": "DEVICE001", "test_name": "Device.id Schema Validation", "status": "Failed", "steps": [{"step_id": "TASK001", "description": "Get device ID", "status": "Failed", "request": {"id": 1, "jsonrpc": "2.0", "method": "Device.id", "params": {}}, "response": {"error": {"code": -32001, "message": "Custom error: device.info.mac_address error"}, "id": 1, "jsonrpc": "2.0"}, "error": "Schema validation failed: Validation Error: Schema validation error: Missing required field: result", "duration_ms": 121}], "duration_ms": 121}, {"test_id": "DEVICE002", "test_name": "Device.distributor Schema Validation", "status": "Failed", "steps": [{"step_id": "TASK001", "description": "Get distributor ID", "status": "Failed", "request": {"id": 1, "jsonrpc": "2.0", "method": "Device.distributor", "params": {}}, "response": {"error": {"code": -32001, "message": "Custom error: Distributor ID not found"}, "id": 1, "jsonrpc": "2.0"}, "error": "Schema validation failed: Validation Error: Schema validation error: Missing required field: result", "duration_ms": 111}], "duration_ms": 111}, {"test_id": "DEVICE003", "test_name": "Device.platform Schema Validation", "status": "Passed", "steps": [{"step_id": "TASK001", "description": "Get platform ID", "status": "Success", "request": {"id": 1, "jsonrpc": "2.0", "method": "Device.platform", "params": {}}, "response": {"id": 1, "jsonrpc": "2.0", "result": "WPE"}, "duration_ms": 109}], "duration_ms": 109}, {"test_id": "DEVICE004", "test_name": "Device.uid Schema Validation", "status": "Failed", "steps": [{"step_id": "TASK001", "description": "Get unique device ID", "status": "Failed", "request": {"id": 1, "jsonrpc": "2.0", "method": "Device.uid", "params": {}}, "response": {"error": {"code": -32001, "message": "Custom error: Error: failed to get account session"}, "id": 1, "jsonrpc": "2.0"}, "error": "Schema validation failed: Validation Error: Schema validation error: Missing required field: result", "duration_ms": 115}], "duration_ms": 115}, {"test_id": "DEVICE005", "test_name": "Device.type Schema Validation", "status": "Passed", "steps": [{"step_id": "TASK001", "description": "Get device type", "status": "Success", "request": {"id": 1, "jsonrpc": "2.0", "method": "Device.type", "params": {}}, "response": {"id": 1, "jsonrpc": "2.0", "result": "ipstb"}, "duration_ms": 108}], "duration_ms": 108}, {"test_id": "DEVICE006", "test_name": "Device.model Schema Validation", "status": "Passed", "steps": [{"step_id": "TASK001", "description": "Get device model", "status": "Success", "request": {"id": 1, "jsonrpc": "2.0", "method": "Device.model", "params": {}}, "response": {"id": 1, "jsonrpc": "2.0", "result": "XiOne-SCB"}, "duration_ms": 113}], "duration_ms": 113}, {"test_id": "DEVICE007", "test_name": "Device.sku Schema Validation", "status": "Failed", "steps": [{"step_id": "TASK001", "description": "Get device SKU", "status": "Failed", "request": {"id": 1, "jsonrpc": "2.0", "method": "Device.sku", "params": {}}, "response": {"error": {"code": -32100, "message": "Failed to get SKU"}, "id": 1, "jsonrpc": "2.0"}, "error": "Schema validation failed: Validation Error: Schema validation error: Missing required field: result", "duration_ms": 123}], "duration_ms": 123}, {"test_id": "DEVICE008", "test_name": "Device.make Schema Validation", "status": "Failed", "steps": [{"step_id": "TASK001", "description": "Get device make/manufacturer", "status": "Failed", "request": {"id": 1, "jsonrpc": "2.0", "method": "Device.make", "params": {}}, "response": {"id": 1, "jsonrpc": "2.0", "result": null}, "error": "Schema validation failed: Validation Error: Schema validation error: Type mismatch at result: expected string, got null", "duration_ms": 120}], "duration_ms": 120}, {"test_id": "DEVICE009", "test_name": "Device.version Schema Validation", "status": "Passed", "steps": [{"step_id": "TASK001", "description": "Get device version information", "status": "Success", "request": {"id": 1, "jsonrpc": "2.0", "method": "Device.version", "params": {}}, "response": {"id": 1, "jsonrpc": "2.0", "result": {"api": {"major": 1, "minor": 5, "patch": 0, "readable": "Firebolt API v1.5.0"}, "debug": "1.1.0", "firmware": {"major": 6, "minor": 9, "patch": 0, "readable": "SCXI11BEI_VBN_23Q4_sprint_20231107000320sdy_FG_EDGE_R2PB_NG"}, "os": {"major": 6, "minor": 9, "patch": 0, "readable": "SCXI11BEI_VBN_23Q4_sprint_20231107000320sdy_FG_EDGE_R2PB_NG"}}}, "duration_ms": 113}], "duration_ms": 113}, {"test_id": "DEVICE010", "test_name": "Device.hdcp Schema Validation", "status": "Failed", "steps": [{"step_id": "TASK001", "description": "Get HDCP versions", "status": "Failed", "request": {"id": 1, "jsonrpc": "2.0", "method": "Device.hdcp", "params": {}}, "response": {"error": "ParseError", "id": 1, "jsonrpc": "2.0"}, "error": "Schema validation failed: Validation Error: Schema validation error: Missing required field: result", "duration_ms": 126}], "duration_ms": 126}, {"test_id": "DEVICE011", "test_name": "Device.hdr Schema Validation", "status": "Passed", "steps": [{"step_id": "TASK001", "description": "Get HDR capabilities", "status": "Success", "request": {"id": 1, "jsonrpc": "2.0", "method": "Device.hdr", "params": {}}, "response": {"id": 1, "jsonrpc": "2.0", "result": {"code": -32100, "message": "could not get device hdr"}}, "duration_ms": 126}], "duration_ms": 126}, {"test_id": "DEVICE012", "test_name": "Device.audio Schema Validation", "status": "Passed", "steps": [{"step_id": "TASK001", "description": "Get audio capabilities", "status": "Success", "request": {"id": 1, "jsonrpc": "2.0", "method": "Device.audio", "params": {}}, "response": {"error": "ParseError", "id": 1, "jsonrpc": "2.0", "result": {"error": "An error message from calling the downstream http service=http://127.0.0.1:9005/as in http broker BrokerError(\"error trying to connect: tcp connect error: Connection refused (os error 61)\")"}}, "duration_ms": 129}], "duration_ms": 129}, {"test_id": "DEVICE013", "test_name": "Device.screenResolution Schema Validation", "status": "Failed", "steps": [{"step_id": "TASK001", "description": "Get screen resolution", "status": "Failed", "request": {"id": 1, "jsonrpc": "2.0", "method": "Device.screenResolution", "params": {}}, "response": {"error": {"code": -32100, "message": "error, failed to get screen resolution"}, "id": 1, "jsonrpc": "2.0"}, "error": "Schema validation failed: Validation Error: Schema validation error: Missing required field: result", "duration_ms": 125}], "duration_ms": 125}, {"test_id": "DEVICE014", "test_name": "Device.videoResolution Schema Validation", "status": "Passed", "steps": [{"step_id": "TASK001", "description": "Get video resolution", "status": "Success", "request": {"id": 1, "jsonrpc": "2.0", "method": "Device.videoResolution", "params": {}}, "response": {"error": "ParseError", "id": 1, "jsonrpc": "2.0", "result": {"error": "An error message from calling the downstream http service=http://127.0.0.1:9005/as in http broker BrokerError(\"error trying to connect: tcp connect error: Connection refused (os error 61)\")"}}, "duration_ms": 119}], "duration_ms": 119}, {"test_id": "DEVICE015", "test_name": "Device.name Schema Validation", "status": "Passed", "steps": [{"step_id": "TASK001", "description": "Get device name", "status": "Success", "request": {"id": 1, "jsonrpc": "2.0", "method": "Device.name", "params": {}}, "response": {"id": 1, "jsonrpc": "2.0", "result": "My Device"}, "duration_ms": 125}], "duration_ms": 125}, {"test_id": "DEVICE016", "test_name": "Device.network Schema Validation", "status": "Failed", "steps": [{"step_id": "TASK001", "description": "Get network information", "status": "Failed", "request": {"id": 1, "jsonrpc": "2.0", "method": "Device.network", "params": {}}, "response": {"error": "ParseError", "id": 1, "jsonrpc": "2.0"}, "error": "Schema validation failed: Validation Error: Schema validation error: Missing required field: result", "duration_ms": 124}], "duration_ms": 124}]};
    // Category extraction
    const categories = Array.from(new Set(data.test_results.map(t => t.test_id.split(/\d/)[0])));
    let selectedCategory = 'All';
    function renderCategoryTabs() {
      const catTabs = document.getElementById('categoryTabs');
      catTabs.innerHTML = '';
      const allTab = document.createElement('div');
      allTab.className = 'tab' + (selectedCategory === 'All' ? ' active' : '');
      allTab.textContent = 'All';
      allTab.onclick = () => { selectedCategory = 'All'; renderCategoryTabs(); showTab(currentStatusTab); };
      catTabs.appendChild(allTab);
      categories.forEach(cat => {
        const tab = document.createElement('div');
        tab.className = 'tab' + (cat === selectedCategory ? ' active' : '');
        tab.textContent = cat;
        tab.onclick = () => { selectedCategory = cat; renderCategoryTabs(); showTab(currentStatusTab); };
        catTabs.appendChild(tab);
      });
    }

    // Category summary table
    function renderCategorySummaryTable() {
      const tbody = document.getElementById('categorySummaryBody');
      tbody.innerHTML = '';
      const allCats = categories;
      allCats.forEach(cat => {
        const catTests = data.test_results.filter(t => t.test_id.split(/\d/)[0] === cat);
        const total = catTests.length;
        const passed = catTests.filter(t => t.status === 'Passed' || t.status === 'Success').length;
        const failed = catTests.filter(t => t.status === 'Failed').length;
        const skipped = catTests.filter(t => t.status === 'Skipped').length;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td style='padding:8px;text-align:center;'>${cat}</td><td style='padding:8px;text-align:center;'>${total}</td><td style='padding:8px;text-align:center;color:#2e7d32;'>${passed}</td><td style='padding:8px;text-align:center;color:#c62828;'>${failed}</td><td style='padding:8px;text-align:center;color:#888;'>${skipped}</td>`;
        tbody.appendChild(tr);
      });
    }

    // Tab logic
    let currentStatusTab = 'All';
    window.showTab = function(status) {
      currentStatusTab = status;
      document.getElementById('tab-all').classList.remove('active');
      document.getElementById('tab-pass').classList.remove('active');
      document.getElementById('tab-fail').classList.remove('active');
      if (status === 'All') {
        document.getElementById('tab-all').classList.add('active');
      } else if (status === 'Passed') {
        document.getElementById('tab-pass').classList.add('active');
      } else {
        document.getElementById('tab-fail').classList.add('active');
      }
      renderTestList(status);
    }

    function renderTestList(status) {
      const testList = document.getElementById('testList');
      testList.innerHTML = '';
      let filtered = data.test_results;
      if (selectedCategory !== 'All') {
        filtered = filtered.filter(t => t.test_id.split(/\d/)[0] === selectedCategory);
      }
      if (status === 'Passed') {
        filtered = filtered.filter(t => t.status === 'Passed' || t.status === 'Success');
      } else if (status === 'Failed') {
        filtered = filtered.filter(t => t.status === 'Failed');
      }
      // Sort: Passed first, then Failed, then Skipped
      filtered.sort((a, b) => {
        const order = { 'Passed': 0, 'Success': 0, 'Failed': 1, 'Skipped': 2 };
        return order[a.status] - order[b.status];
      });
      if (filtered.length === 0) {
        testList.innerHTML = `<div>No ${status === 'All' ? '' : status.toLowerCase()} test cases${selectedCategory !== 'All' ? ' in ' + selectedCategory : ''}.</div>`;
        return;
      }
      filtered.forEach((test, idx) => {
        const testDiv = document.createElement('div');
        testDiv.className = 'test-item';
        testDiv.style.cursor = 'pointer';
        testDiv.innerHTML = `<span class="test-name">${test.test_name}</span> <span class="test-status ${test.status.toLowerCase()}">${test.status}</span>`;

        // Details div (hidden by default)
        const detailsDiv = document.createElement('div');
        detailsDiv.style.display = 'none';
        detailsDiv.style.background = '#f5f5f5';
        detailsDiv.style.borderRadius = '6px';
        detailsDiv.style.margin = '10px 0 0 0';
        detailsDiv.style.padding = '10px 16px';
        detailsDiv.style.fontSize = '0.97em';
        if (test.steps && test.steps.length > 0) {
          test.steps.forEach((step, sidx) => {
            detailsDiv.innerHTML += `<div style='margin-bottom:8px;'><b>Step:</b> ${step.description}<br>`;
            if (step.request) {
              detailsDiv.innerHTML += `<b>Request:</b><pre style='background:#eee;padding:6px;border-radius:4px;overflow-x:auto;'>${JSON.stringify(step.request, null, 2)}</pre>`;
            }
            if (step.response) {
              detailsDiv.innerHTML += `<b>Response:</b><pre style='background:#eee;padding:6px;border-radius:4px;overflow-x:auto;'>${JSON.stringify(step.response, null, 2)}</pre>`;
            }
            if (step.error) {
              detailsDiv.innerHTML += `<b style='color:#c62828;'>Error:</b> <span style='color:#c62828;'>${step.error}</span>`;
            }
            detailsDiv.innerHTML += `</div>`;
          });
        }
        testDiv.appendChild(detailsDiv);

        // Toggle details on click
        testDiv.addEventListener('click', function(e) {
          // Only toggle if not clicking a link or input
          if (e.target.tagName === 'A' || e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON') return;
          detailsDiv.style.display = detailsDiv.style.display === 'none' ? 'block' : 'none';
        });

        testList.appendChild(testDiv);
      });
    }

    // Initial render
    renderCategoryTabs();
    renderCategorySummaryTable();
    window.showTab('All');
  </script>
</body>
</html>
